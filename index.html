<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<title>Texas O&G Wells Map</title>
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css"/>
<link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css"/>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Segoe UI',system-ui,sans-serif;background:#1a1a2e;color:#e0e0e0;overflow:hidden}
#map{position:absolute;top:50px;left:0;right:0;bottom:0;z-index:1}
#header{height:50px;background:#16213e;display:flex;align-items:center;padding:0 20px;border-bottom:1px solid #0f3460;z-index:1000;position:relative}
#header h1{font-size:18px;color:#e94560;font-weight:700;white-space:nowrap}
#stats{margin-left:30px;font-size:13px;color:#a0a0b0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}

#panel{position:absolute;top:50px;right:0;width:300px;background:#16213e;z-index:1000;height:calc(100vh - 50px);overflow-y:auto;border-left:1px solid #0f3460;transition:transform .3s ease}
#panel.hidden{transform:translateX(100%)}
#panel h2{padding:12px 15px;font-size:14px;color:#e94560;border-bottom:1px solid #0f3460;display:flex;justify-content:space-between;align-items:center;position:sticky;top:0;background:#16213e;z-index:2}

.filter-section{border-bottom:1px solid #0f3460;overflow:hidden}
.filter-header{padding:10px 15px;font-size:13px;font-weight:600;color:#a0a0b0;cursor:pointer;display:flex;justify-content:space-between;align-items:center;user-select:none;-webkit-tap-highlight-color:transparent}
.filter-header:hover{background:#1a1a3e}
.filter-header .arrow{transition:transform .2s;font-size:10px}
.filter-header .arrow.open{transform:rotate(90deg)}
.filter-body{padding:0 15px 10px;max-height:0;overflow:hidden;transition:max-height .3s ease}
.filter-body.open{max-height:500px;overflow-y:auto}

.op-row{display:flex;align-items:center;padding:6px 0;cursor:pointer;transition:background .2s;-webkit-tap-highlight-color:transparent}
.op-row:active{background:#1a1a3e}
.op-color{width:14px;height:14px;border-radius:50%;margin-right:10px;flex-shrink:0}
.op-label{font-size:13px;flex:1}
.op-count{font-size:11px;color:#888;margin-left:5px}
.op-row input,.filter-body input[type=checkbox]{margin-right:8px;width:18px;height:18px;accent-color:#e94560;flex-shrink:0}

.filter-opt{display:flex;align-items:center;padding:4px 0;font-size:13px;cursor:pointer;-webkit-tap-highlight-color:transparent}
.filter-opt:active{background:#1a1a3e}

.filter-body select{width:100%;padding:8px;background:#1a1a2e;color:#e0e0e0;border:1px solid #0f3460;border-radius:4px;font-size:13px;margin-top:4px}

#toggle-panel{position:absolute;top:60px;right:10px;z-index:1001;background:#16213e;border:1px solid #0f3460;color:#e0e0e0;padding:8px 12px;border-radius:4px;cursor:pointer;font-size:13px;-webkit-tap-highlight-color:transparent;touch-action:manipulation}
#toggle-panel:active{background:#0f3460}

.legend-section{padding:10px 15px;border-top:1px solid #0f3460}
.legend-section h3{font-size:12px;color:#888;margin-bottom:8px}
.legend-item{display:flex;align-items:center;font-size:12px;margin-bottom:4px}
.legend-dot{width:10px;height:10px;border-radius:50%;margin-right:8px}

.leaflet-popup-content-wrapper{background:#16213e!important;color:#e0e0e0!important;border-radius:8px!important;border:1px solid #0f3460;max-width:320px!important}
.leaflet-popup-tip{background:#16213e!important}
.leaflet-popup-content{font-size:13px;line-height:1.6;margin:10px 14px!important}
.leaflet-popup-content strong{color:#e94560}
.marker-cluster{background:rgba(233,69,96,.3)!important}
.marker-cluster div{background:rgba(233,69,96,.7)!important;color:#fff!important;font-weight:700}
.leaflet-tile{filter:brightness(0.7) contrast(1.1) saturate(0.3)}
.leaflet-control-zoom a{background:#16213e!important;color:#e0e0e0!important;border-color:#0f3460!important}
.leaflet-control-attribution{background:rgba(22,33,62,.8)!important;color:#666!important}
.leaflet-control-attribution a{color:#888!important}

.sm-btn{background:none;border:1px solid #0f3460;color:#e0e0e0;padding:2px 8px;border-radius:3px;cursor:pointer;font-size:11px;-webkit-tap-highlight-color:transparent}
.sm-btn:active{background:#0f3460}

.popup-label{color:#888;font-size:11px;text-transform:uppercase;letter-spacing:0.5px}
.popup-value{font-size:13px;margin-bottom:4px}

@media(max-width:768px){
  #header h1{font-size:15px}
  #stats{display:none}
  #panel{width:100%;top:auto;bottom:0;height:55vh;border-left:none;border-top:1px solid #0f3460;border-radius:12px 12px 0 0}
  #panel.hidden{transform:translateY(100%)}
  #panel h2{border-radius:12px 12px 0 0}
  #toggle-panel{bottom:10px;right:10px;top:auto;padding:12px 16px;font-size:14px;border-radius:8px;box-shadow:0 2px 8px rgba(0,0,0,.4)}
  #panel.hidden~#toggle-panel{bottom:10px}
  .op-row{padding:8px 0}
  .filter-opt{padding:6px 0}
  .leaflet-popup-content-wrapper{max-width:280px!important}
}
</style>
</head>
<body>
<div id="header">
  <h1>üõ¢Ô∏è Texas O&G Wells ‚Äî Permian Basin</h1>
  <div id="stats">Loading...</div>
</div>
<div id="map"></div>
<button id="toggle-panel" onclick="togglePanel()">‚ò∞ Filters</button>
<div id="panel">
  <h2>Filters <button class="sm-btn" onclick="resetFilters()">Reset</button></h2>

  <!-- Well Type -->
  <div class="filter-section">
    <div class="filter-header" onclick="toggleSection(this)">Well Type <span class="arrow open">‚ñ∂</span></div>
    <div class="filter-body open">
      <label class="filter-opt"><input type="checkbox" class="wtype-cb" value="oil" checked onchange="applyFilters()"> üü¢ Oil</label>
      <label class="filter-opt"><input type="checkbox" class="wtype-cb" value="gas" checked onchange="applyFilters()"> üî¥ Gas</label>
      <label class="filter-opt"><input type="checkbox" class="wtype-cb" value="both" checked onchange="applyFilters()"> üü° Oil & Gas</label>
    </div>
  </div>

  <!-- County -->
  <div class="filter-section">
    <div class="filter-header" onclick="toggleSection(this)">County <span class="arrow">‚ñ∂</span></div>
    <div class="filter-body">
      <select id="county-filter" onchange="applyFilters()"><option value="">All Counties</option></select>
    </div>
  </div>

  <!-- Operators -->
  <div class="filter-section">
    <div class="filter-header" onclick="toggleSection(this)">Operators <span class="arrow open">‚ñ∂</span></div>
    <div class="filter-body open" style="max-height:400px">
      <div style="margin-bottom:6px"><button class="sm-btn" onclick="toggleAllOps()">Toggle All</button></div>
      <div id="op-list"></div>
    </div>
  </div>

  <div class="legend-section">
    <h3>Legend</h3>
    <div class="legend-item"><div class="legend-dot" style="background:#4daf4a"></div> Oil Well</div>
    <div class="legend-item"><div class="legend-dot" style="background:#e94560"></div> Gas Well</div>
    <div class="legend-item"><div class="legend-dot" style="background:#f5c542"></div> Oil & Gas Well</div>
    <p style="font-size:11px;color:#666;margin-top:8px">Well types from Texas RRC (SYMNUM classification). Operators from FracFocus disclosure registry. 27,806 verified wells.</p>
  </div>

  <div class="legend-section" style="border-top:1px solid #0f3460">
    <h3>Data Sources</h3>
    <p style="font-size:11px;color:#666;line-height:1.5">
      üìç Coordinates & operators: FracFocus.org<br>
      üè∑Ô∏è Well type (oil/gas): Texas RRC GIS (SYMNUM)<br>
      ‚ö†Ô∏è No fake or estimated data
    </p>
  </div>
</div>

<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
<script>
const map=L.map('map',{center:[31.8,-102],zoom:7,zoomControl:true});
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',{attribution:'¬© OpenStreetMap',maxZoom:18}).addTo(map);

const WELL_COLORS={oil:'#4daf4a',gas:'#e94560',both:'#f5c542'};

let operators=[],wells=[];
let clusterGroup=L.markerClusterGroup({maxClusterRadius:40,spiderfyOnMaxZoom:true,showCoverageOnHover:false,
  iconCreateFunction:c=>{
    const n=c.getChildCount();
    return L.divIcon({html:'<div>'+n+'</div>',className:'marker-cluster marker-cluster-'+(n>100?'large':n>30?'medium':'small'),iconSize:[40,40]});
  }
});
map.addLayer(clusterGroup);

let allOpsVisible=true;

async function loadData(){
  [operators,wells]=await Promise.all([
    fetch('operators.json').then(r=>r.json()),
    fetch('wells.json').then(r=>r.json())
  ]);
  buildCountyFilter();
  buildPanel();
  applyFilters();
}

function buildCountyFilter(){
  const counties=new Set();
  wells.forEach(w=>counties.add(w.county));
  const sel=document.getElementById('county-filter');
  [...counties].sort().forEach(c=>{
    const o=document.createElement('option');o.value=c;o.textContent=c;sel.appendChild(o);
  });
}

function buildPanel(){
  // Count wells per operator
  const opCounts={};
  wells.forEach(w=>{opCounts[w.operator]=(opCounts[w.operator]||0)+1;});
  
  document.getElementById('op-list').innerHTML=operators.map(op=>`
    <label class="op-row">
      <input type="checkbox" checked class="op-cb" data-op="${op.name}" onchange="applyFilters()">
      <span class="op-label">${op.name}</span>
      <span class="op-count">${opCounts[op.name]||0}</span>
    </label>
  `).join('');
}

function applyFilters(){
  clusterGroup.clearLayers();

  const types=new Set([...document.querySelectorAll('.wtype-cb:checked')].map(c=>c.value));
  const county=document.getElementById('county-filter').value;
  const ops=new Set([...document.querySelectorAll('.op-cb:checked')].map(c=>c.dataset.op));

  let count=0;
  wells.forEach(w=>{
    if(!ops.has(w.operator))return;
    if(!types.has(w.type))return;
    if(county&&w.county!==county)return;
    
    const color=WELL_COLORS[w.type]||'#888';
    const c=L.circleMarker([w.lat,w.lng],{radius:5,color,fillColor:color,fillOpacity:0.7,weight:1,opacity:0.9});
    
    c.bindPopup(`
      <strong style="color:${color}">${w.type.toUpperCase()} WELL</strong><br>
      <span class="popup-label">API</span><div class="popup-value">${w.api}</div>
      <span class="popup-label">Operator</span><div class="popup-value">${w.operator}</div>
      <span class="popup-label">County</span><div class="popup-value">${w.county}</div>
    `,{maxWidth:280});
    
    clusterGroup.addLayer(c);
    count++;
  });

  document.getElementById('stats').textContent=`${count.toLocaleString()} wells | ${ops.size} operators | Permian Basin`;
}

function toggleAllOps(){
  allOpsVisible=!allOpsVisible;
  document.querySelectorAll('.op-cb').forEach(c=>c.checked=allOpsVisible);
  applyFilters();
}

function togglePanel(){document.getElementById('panel').classList.toggle('hidden')}

function toggleSection(el){
  const arrow=el.querySelector('.arrow');
  const body=el.nextElementSibling;
  arrow.classList.toggle('open');
  body.classList.toggle('open');
}

function resetFilters(){
  document.querySelectorAll('.wtype-cb,.op-cb').forEach(c=>c.checked=true);
  document.getElementById('county-filter').value='';
  allOpsVisible=true;
  applyFilters();
}

loadData();
</script>
</body>
</html>
